<!doctype html>
<html lang="en">
	<head>
		<%- include('./partials/head')  %> 
	</head>
	<body class="single-page page">
		<div class="container-fluid" id="header">	
			<%- include('./partials/header') %> 		
		</div>
		<div class="container-fluid" id="body">
			<div class="container pt-30">
				<form method="POST", action="/post/<%= post._id %>/editPost ">
				<div class="row blog-teaser">
						<div class="col-12 mt-4 mb-2">
							<input type="text" name="header" placeholder="Headline" value="<%= post.header %>">
						</div>
						<div class="col-12 my-2">
							<!-- <button class="btn btn-custom" style="width:132px; margin-left: 0; position: absolute" >Choose image</button><span style="position: absolute; margin-left: 145px; margin-top: 12px;">display image name</span>
							<input class="upload-btn" type="file" style="margin-top:8px; position:relative; opacity: 0;"> -->
							<form enctype="multipart/form-data">
								<input id="picture" name="picture" type="file" />
								<input onclick="upload()" type="button" value="Upload" />
							</form>
							<progress></progress> <!-- we can delete this -->
							<p id="uploadAlert"></p>
						</div>
						<div class="col-md-12 my-2">
							<textarea class="col-md-8 p-1" name="text" placeholder="Blog text"><%- post.text %></textarea>
						</div>
						<div class="col-12 mt-4 mb-2">
							<input type="text" name="keywords" placeholder="Keywords" value="<%= post.keywords %>">
						</div>
						<div class="col-md-12 mt-2 mb-4">
							<button class="btn btn-custom" type="submit">Submit</button>
							<button class="btn btn-custom" type="reset">Reset</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<script>
			function upload() {
				var pathname = window.location.pathname
				var reg = /\/post\/.{24}\//
				var url = pathname.match(reg)[0] + 'uploadPhoto'

				var formData = new FormData()
				formData.append('picture', $('#picture')[0].files[0])

				$.ajax({
					// Your server script to process the upload
					url: url,
					type: 'POST',

					// Form data
					data: formData,

					// Tell jQuery not to process data or worry about content-type
					// You *must* include these options!
					cache: false,
					contentType: false,
					processData: false,

					// Custom XMLHttpRequest
					xhr: function () {
					var myXhr = $.ajaxSettings.xhr()
					if (myXhr.upload) {
						// For handling the progress of the upload
						myXhr.upload.addEventListener('progress', function (e) {
						if (e.lengthComputable) {
							$('progress').attr({
							value: e.loaded,
							max: e.total,
							})
						}
						}, false)
					}
					return myXhr
					},
					success: function (data){
						if(data.error){
							$('#uploadAlert').text(data.error.message)
						}else{
							$('#uploadAlert').text(data.message)
						}
					}
				})
			}
		</script>
	</body>
</html>
	