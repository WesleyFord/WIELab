<!doctype html>
<html lang="en">
	<head>
		<%- include('./partials/head')  %> 
	</head>
	<body class="single-page page">	
		<%- include('./partials/header')  %> 	
		<div class="container-fluid" id="body">
			<div class="container">
				<%- include('./partials/navigation')  %> 
				<div class="row blog-teaser">
					<div class="col-12">
						<% if(user._id.equals(post.userId)) { %> 
							<a class="custom-link" href="/post/<%= post._id %>/editPost ">>Edit Post</a>
						<% } %> 
					</div>
					<div class="col-12">
						<h2 class="blog-hl"><%= post.header %></h2>
					</div>
					
					<div class="col-md-12">
						<% if(post.picture){ %>
							<img class="blog-img blog-img-inline p-0" src="/uploads/post/<%= post.picture %> "> 
						<% } %> 
						<p>
							<%= post.text %>
						</p>
						<p id="likeCount">
							<%#  post.text %> 

						</p>
						<button id="likeButton" class="btn btn-custom mx-0" onclick="changeLikeStatus()"></button>
					</div>
				</div>
			</div>
		</div>
		<script>
			$(document).ready(function(){
				getLikeCount()
				getLikeStatus()
			})

			function getLikeStatus(){
				var pathname = window.location.pathname
				var reg = /\/post\/.{24}/
				var url = pathname.match(reg)[0] + '/likeStatus'

				$.get(url, function(data){
					console.log('like status', data.likeStatus)
					if(data.error){
						console.log(data.error.message)
					} else if(data.likeStatus){
						$('#likeButton').text('Remove Like')
					}else{
						$('#likeButton').text('Like')
					}
				})
			}

			function getLikeCount(){
				var pathname = window.location.pathname
				var reg = /\/post\/.{24}/
				var url = pathname.match(reg)[0] + '/likes'		

				$.get(url, function(data){
					console.log('like count', data.postLikes)
					if(data.error){
						$('#likeCount').text(data.error.message)
					} else{
						$('#likeCount').text(data.postLikes + ((data.postLikes == 1) ? ' like' : ' likes'))
					}
				})
			}

			function changeLikeStatus(){
				var pathname = window.location.pathname
				var reg = /\/post\/.{24}/
				var url = pathname.match(reg)[0] + '/like'
				$.post(url, function(data){
					if(data.error){
						console.log(data.message)
					}
					getLikeCount()
					getLikeStatus()
				})
			}


		</script>
	</body>
</html>
	