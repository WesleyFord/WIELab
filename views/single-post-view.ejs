<!doctype html>
<html lang="en">
	<head>
		<%- include('./partials/head')  %> 
	</head>
	<body class="single-page page">
		<div class="container-fluid" id="header">	
			<%- include('./partials/header')  %> 	
		</div>
		<div class="container-fluid" id="body">
			<div class="container">
				<% include('./partials/navigation') %> 
				<div class="row blog-teaser">
					<div class="col-12">
						<% if(user._id.equals(post.userId)) { %> 
							<a href="/post/<%= post._id %>/editPost "><button class="btn btn-custom">Edit Post</button></a>
						<% } %> 
					</div>
					<div class="col-12">
						<h2 class="blog-hl"><%= post.header %></h2>
					</div>
					<div class="col-12">
						<a href=%/user/<%= user.userID>Author: <%= user%></a>
					</div>
					<div class="col-12">
						<a href="#"><%= post.date%></a>
					</div>
					<div class="col-md-12">
						<% if(post.picture){ %>
							<img class="blog-img blog-img-inline p-0" src="/uploads/post/<%= post.picture %> "> 
						<% } %> 
						<p>
							<%= post.text %>
						</p>
						<p id="likeCount">
							<%#  post.text %> 

						</p>
						<button id="likeButton" class="btn btn-custom" onclick="changeLikeStatus()"></button>
					</div>
				</div>	
				<div class="row blog-teaser">
					<h2 style="margin:10px">Comments</h2>
					<textarea class="form-control" style="margin:10px">Enter comment</textarea>
					<button id="commentSubmit" class="btn btn-primary" style="margin:10px">Submit</button>			
				</div>
				<% for (const comment in comments){ %>
					<div class="row blog-teaser">
						<a href="/">
							<img class="profile-img" src= "/uploads/user/<%= comment.author.profilePicture %> ">
							<span> <%= comment.author %> </span>
						</a>
						<p class="col-12"><%= comment.text %></p>
					</div>
				<% } %>
			</div>
		</div>
		<script>
			$(document).ready(function(){
				getLikeCount()
				getLikeStatus()
			})

			function getLikeStatus(){
				var pathname = window.location.pathname
				var reg = /\/post\/.{24}/
				var url = pathname.match(reg)[0] + '/likeStatus'

				$.get(url, function(data){
					console.log('like status', data.likeStatus)
					if(data.error){
						console.log(data.error.message)
					} else if(data.likeStatus){
						$('#likeButton').text('Remove Like')
					}else{
						$('#likeButton').text('Like')
					}
				})
			}

			function getLikeCount(){
				var pathname = window.location.pathname
				var reg = /\/post\/.{24}/
				var url = pathname.match(reg)[0] + '/likes'		

				$.get(url, function(data){
					console.log('like count', data.postLikes)
					if(data.error){
						$('#likeCount').text(data.error.message)
					} else{
						$('#likeCount').text(data.postLikes + ' likes')
					}
				})
			}

			function changeLikeStatus(){
				var pathname = window.location.pathname
				var reg = /\/post\/.{24}/
				var url = pathname.match(reg)[0] + '/like'
				$.post(url, function(data){
					if(data.error){
						console.log(data.message)
					}
					getLikeCount()
					getLikeStatus()
				})
			}


		</script>
	</body>
</html>
	